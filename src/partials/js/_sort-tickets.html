<script>
  const titoFindText = {
    COMBO: 'Combo',
    WORKSHOPS: 'Workshop',
    REMOTE: 'Remote Attendance'
  }
  const TITO_SECTION = [
    {
      title: 'Workshops',
      findText: titoFindText.WORKSHOPS,
    },
    {
      title: 'Remote',
      findText: titoFindText.REMOTE,
    },
    {
      title: 'Combo tickets',
      findText: titoFindText.COMBO,
    },
  ]

  function sortTickets() {
    let daElements = document.querySelectorAll('.tito-release:not(.tito-release--sold-out)');
    let daElementsArray = [];
    let daPlace = 'last';
    //Заполняем массивы
    if (daElements.length > 0) {
      let number = 0;

      TITO_SECTION.forEach((section, index) => {
        if (!document.querySelector('#' + getClassName(section.title))) {
          const tickets = [...daElements].filter(el => {
            const daElementTitle = el.querySelector('.tito-release--title').innerText;
            return section.findText === titoFindText.REMOTE ? daElementTitle.includes(section.findText) : daElementTitle.includes(section.findText) && !daElementTitle.includes(titoFindText.REMOTE)
          });
          console.log(111)

          createSection(section.title, index + 2);


          tickets.forEach(ticket => {
            ticket.style.order = index + 2
            // daElementsArray[number] = {
            //   "element": ticket,
            //   "destination": index,
            // };
            number++;
          })
        } else {
          removeSection(section.title)
        }
      })
    }
    //Перебрасываем элементы
    daElementsArray.forEach(el => {
      // daPlace === 'first' ? actualIndex = 0 : actualIndex = el.destination.children.length;
      // el.destination.insertBefore(el.element, el.destination.children[actualIndex]);
      // el.style.order = el.destination
    })
  }

  function getClassName(title) {
    return title.toLowerCase().replace(/\s+/g, '-')
  }

  function createSection(title, order) {
    const sectionHtml = `
        <section class="tito-section" id="${getClassName(title)}" style="order: ${order}">
          <h3 class="tito-section__title">${title}</h3>
        </section>
      `;
    document.querySelector('.tito-widget-form > div').insertAdjacentHTML('afterbegin', sectionHtml);
  }

  function removeSection(title) {
    document.querySelector('#' + getClassName(title)).remove();
  }

  tito('on:widget:loaded', function () {
    sortTickets();
  });

</script>
