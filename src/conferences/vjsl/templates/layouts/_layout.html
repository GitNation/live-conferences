{% import "parts/_mixins.html" as own_mixins %} {% import "partials/_mixins.html" as mixins %} {% import "ga/ga-mixins.njk" as ga_mixins %} {% import
"eventsBus/eventsBus.njk" as eventsLayer %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ pages[pageKey].titleSeo }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% include "../partials/_media-tags.html" %}
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" media="all" href="css/app.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="shortcut icon" href="img/favicon.png" />
    <script src="https://www.googleoptimize.com/optimize.js?id=OPT-NJ3WMDT"></script>
  </head>
  <body>
    {{eventsLayer.initEventsLayer(pageKey)}} {{eventsLayer.mountPoint('dialog-popup')}} {{eventsLayer.sendContent('eventInfo', customContent.eventInfo )}} {% if
    not fakeLinks %}{% set linkToRecordings = "http://bit.ly/rsre2021-conf-full-ticket-aAf1" %}{% endif %} {{eventsLayer.sendContent('reactLayerConfig', {
    ticketsLink: pagesPieceOfTexts.ticket__link, calendarEventName: 'React Summit', calendarEventDescription: 'Watch it live at https://remote.reactsummit.com',
    calendarWorkshopDescription: 'Please note, by adding the event to your calendar you do not register for the workshop. To register for the session please use
    the link sent from ti.to via email.', hideSpeakerPopupLabel: true, linkToTalkRecordings: linkToRecordings } )}} {{eventsLayer.sendContent('customTracks',
    customContent.tracks )}} {{eventsLayer.sendContent('schedule', schedule )}} {{eventsLayer.sendContent('isAuth', not fakeLinks )}}
    {{eventsLayer.sendContent('isCustomTrackAvailable', customTrackAvailable )}} {{eventsLayer.sendContent('availableTracks', availableTracks)}}
    {{eventsLayer.sendContent('speakers', speakers)}}

    <!-- BEGIN content -->
    <div class="out">{% block content %}{% endblock %}</div>
    <!-- END content -->

    <!-- BEGIN scripts -->
    <script type="text/javascript" src="js/app.js"></script>

    <script type="application/javascript" src="js/_tween.umd.js"></script>
    <script type="application/javascript" src="js/_three.min.js"></script>
    <script type="application/javascript" src="js/_GLTFLoader.js"></script>
    <script type="application/javascript" src="js/_RGBELoader.js"></script>
    <script type="application/javascript" src="js/_postprocessing.min.js"></script>
    <script type="module">
      const particles = [];

      let introDone = false;
      const target = new THREE.Vector3();
      var mouseX = 0,
        mouseY = 0;

      let windowHalfX = window.innerWidth / 2;
      let windowHalfY = window.innerHeight / 2;

      document.addEventListener('mousemove', (event) => {
        mouseX = event.clientX - windowHalfX;
        mouseY = event.clientY - windowHalfY;
      });

      window.camera = null;

      let scene, renderer, composer, logo;
      const clock = new THREE.Clock();
      const zeroVector = new THREE.Vector3(0, 0, 0);
      const loader = new THREE.TextureLoader();

      function init() {
        const canvas = document.getElementById('js-anim-container');
        const container = document.createElement('div');
        container.classList.add('s-hero__animation');
        canvas.appendChild(container);

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 20);
        camera.position.set(0, 7.2, 6.85);

        scene = new THREE.Scene();
        loader.load('./canvas/vue-back-grad.png', function (texture) {
          scene.background = texture;
        });

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, premultipliedAlpha: false });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1;
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.gammaOutput = false;
        container.appendChild(renderer.domElement);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        let directionalLight = new THREE.DirectionalLight(0x2a4465, 3);
        directionalLight.position.set(0, -5, 0);
        scene.add(directionalLight);

        let circleGeo = new THREE.CircleGeometry(2, 32);
        let circleMat = new THREE.MeshBasicMaterial({ color: 0x2a4465 });
        let circle = new THREE.Mesh(circleGeo, circleMat);
        circle.rotation.set(-Math.PI / 2, 0, 0);
        circle.position.set(0, -5, -0.6);
        circle.scale.set(0.75, 0.75, 0);
        scene.add(circle);

        let godraysEffect = new POSTPROCESSING.GodRaysEffect(camera, circle, {
          resolutionScale: 1,
          density: 1,
          decay: 0.95,
          weight: 0.5,
          samples: 100,
        });
        let renderPass = new POSTPROCESSING.RenderPass(scene, camera);
        let effectPass = new POSTPROCESSING.EffectPass(camera, godraysEffect);
        effectPass.renderToScreen = true;
        composer = new POSTPROCESSING.EffectComposer(renderer);
        composer.addPass(renderPass);
        composer.addPass(effectPass);

        let noiseTexture;
        loader.load('./canvas/bump.png', function (texture) {
          texture.flipY = false;
          noiseTexture = texture;
        });

        new THREE.RGBELoader()
          .setDataType(THREE.UnsignedByteType)
          .setPath('./canvas/')
          .load('royal_esplanade_1k.hdr', function (texture) {
            const envMap = pmremGenerator.fromEquirectangular(texture).texture;
            scene.environment = envMap;
            texture.dispose();
            pmremGenerator.dispose();
            const loader = new THREE.GLTFLoader().setPath('./');
            loader.load('canvas/vue.glb', function (gltf) {
              gltf.scene.traverse(function (child) {
                if (child.isMesh) {
                  if (child.name[0] === 't') {
                    const number = parseInt(child.name.replace('t', '')) - 1;
                    particles[number] = child;
                    child.initizalZ = child.position.z;
                  }

                  child.material.metalness = 0.7;
                  child.material.roughness = 0.05;
                  child.material.emissive = child.material.color;
                  child.material.emissiveIntensity = 1.5;
                  child.material.envMapIntensity = 0.1;
                  child.material.bumpMap = noiseTexture;
                  child.material.bumpScale = 2;
                }
              });
              logo = gltf.scene;

              scene.add(gltf.scene);
              animate();

              camera.lookAt(logo.position);

              setTimeout(() => {
                tweenCamera(() => {
                  new TWEEN.Tween(circle.position).to({ x: 0, y: -4, z: 0 }, 10000).repeat(Infinity).yoyo(true).easing(TWEEN.Easing.Cubic.InOut).start();

                  introDone = true;
                });
              }, 750);
            });
          });

        window.addEventListener('resize', onWindowResize);
      }

      function onWindowResize() {
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        animate();
      }

      function animate(time) {
        composer.render(clock.getDelta());
        requestAnimationFrame(animate);
        TWEEN.update(time);
        if (introDone) {
          const deltaX = mouseX - target.x;
          const deltaY = mouseY / windowHalfY;
          target.x += deltaX * 0.02;
          target.y += deltaY * 0.02;
          logo.rotation.z = -Math.atan2(target.x, 170) * 0.3;
          placeParticles(target.y / 2);
        }
      }

      function placeParticles(percentage) {
        particles.forEach((particle, idx) => {
          if (idx < 16) {
            if (idx % 2) {
              particle.position.z = Math.min(particle.initizalZ + percentage / (idx + 4), particle.initizalZ);
            } else {
              particle.position.z = Math.min(particle.initizalZ + percentage / (idx + 2), particle.initizalZ);
            }
          }
        });
      }

      function tweenCamera(callback) {
        new TWEEN.Tween(camera.position)
          .to({ x: 0, y: 10, z: 0 }, 5000)
          .easing(TWEEN.Easing.Quadratic.Out)
          .interpolation(TWEEN.Interpolation.Bezier)
          .onComplete(callback)
          .onUpdate(() => camera.lookAt(zeroVector))
          .start();
      }

      init();
    </script>
    <!-- END scripts -->

    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function () {
        var t = document.createElement('script');
        t.type = 'text/javascript';
        t.async = true;
        t.id = 'gauges-tracker';
        t.setAttribute('data-site-id', '5e836af7318dea32ed0f0ca7');
        t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
        t.src = 'https://d2fuc4clr7gvcn.cloudfront.net/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>

    <!-- Twitter universal website tag code -->
    <script>
      !(function (e, t, n, s, u, a) {
        e.twq ||
          ((s = e.twq = function () {
            s.exe ? s.exe.apply(s, arguments) : s.queue.push(arguments);
          }),
          (s.version = '1.1'),
          (s.queue = []),
          (u = t.createElement(n)),
          (u.async = !0),
          (u.src = '//static.ads-twitter.com/uwt.js'),
          (a = t.getElementsByTagName(n)[0]),
          a.parentNode.insertBefore(u, a));
      })(window, document, 'script');
      // Insert Twitter Pixel ID and Standard Event data below
      twq('init', 'o3job');
      twq('track', 'PageView');
    </script>
    <!-- End Twitter universal website tag code -->

    <!-- Facebook Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = '2.0';
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1374905195888955');
      fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display: none" src="https://www.facebook.com/tr?id=1374905195888955&ev=PageView&noscript=1" /></noscript>
    <!-- End Facebook Pixel Code -->

    <!-- Global site tag (gtag.js) - Google Ads: 805657772 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-805657772"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'AW-805657772');
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZ1BCGD4SL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-164513444-8');
      gtag('config', 'G-TZ1BCGD4SL');
    </script>
  </body>
</html>
